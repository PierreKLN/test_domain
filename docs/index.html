<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Diagnostic de maturité — Industrie</title>
  <style>
    /* ... (tes styles existants inchangés) ... */

    /* ====== Transition PowerPoint-like (sortie) ====== */
    #transition-curtain{
      position:fixed; inset:0; pointer-events:none; opacity:0;
      background:
        radial-gradient(1400px 700px at 15% -10%, rgba(255,255,255,.08), transparent 60%) ,
        linear-gradient(135deg, rgba(10,132,255,.7), rgba(0,0,0,.0) 55%) ,
        linear-gradient(180deg, rgba(0,0,0,.85), rgba(0,0,0,.95));
      transform: translateX(100%) scale(1.02);
      z-index:9999;
    }
    .curtain-animate{
      opacity:1;
      animation: slide-wipe 520ms cubic-bezier(.2,.7,.2,1) forwards;
    }
    @keyframes slide-wipe{
      0%   { transform: translateX(100%) scale(1.02); }
      60%  { transform: translateX(0%)   scale(1.00); }
      100% { transform: translateX(0%)   scale(1.00); }
    }

    /* Petite atténuation du contenu pendant la sortie */
    .page-fade{
      animation: page-dim 380ms ease-out forwards;
    }
    @keyframes page-dim{
      from{ opacity:1; filter:none; transform:none; }
      to  { opacity:.2; filter:blur(2px); transform:scale(.995); }
    }

    /* Respecte l’accessibilité */
    @media (prefers-reduced-motion: reduce){
      .curtain-animate, .page-fade{ animation: none !important; }
      #transition-curtain{ display:none !important; }
    }
  </style>
</head>
<body>
  <!-- rideau de transition -->
  <div id="transition-curtain" aria-hidden="true"></div>

  <!-- ====== le reste de ton HTML identique à la version précédente ====== -->
  <!-- (topbar, sections, questions, footer...) -->

  <script>
    /* ==== (tes scripts existants inchangés jusqu’à computeAndGo) ==== */

    // Ajoute une sortie “diapo” avant la navigation
    function goWithCurtain(targetHref){
      const curtain = document.getElementById('transition-curtain');
      // atténue le contenu
      document.body.classList.add('page-fade');
      // lance le rideau
      curtain.classList.add('curtain-animate');
      // quand l’anim est finie, on change de page
      curtain.addEventListener('animationend', ()=>{ window.location.href = targetHref; }, { once:true });
      // sécurité : si l’évènement rate, on navigue quand même après ~650ms
      setTimeout(()=>{ if(location.href.indexOf(targetHref)===-1){ window.location.href = targetHref; } }, 650);
    }

    function computeAndGo(){
      if(!validateIdentity()) return;
      const unanswered = answers.reduce((acc,v,i)=> (v===null? acc.concat(i+1):acc), []);
      if(unanswered.length){
        if(!confirm(`Vous n'avez pas répondu à ${unanswered.length} question(s). Calculer quand même ?`)) return;
      }

      const catMap = Object.fromEntries(CATEGORIES.map(c=>[c.key,{sum:0,count:0}]));
      QUESTIONS.forEach((q,i)=>{ const v=(answers[i]??0); catMap[q.cat].sum+=v; catMap[q.cat].count+=1; });

      const catScores = CATEGORIES.map(c=>{
        const {sum,count}=catMap[c.key]; const pct=Math.round((sum/(count*3))*100);
        return { key:c.key, label:c.label, pct };
      });
      const global = Math.round(catScores.reduce((a,c)=>a+c.pct,0)/catScores.length);
      const level = global>=76? 'N4 — Smart Factory'
                 : global>=51? 'N3 — Connecté'
                 : global>=26? 'N2 — Automatisé'
                 : 'N1 — Analogique';

      const low = [...catScores].sort((a,b)=>a.pct-b.pct).slice(0,2);

      function buildRecoPredicta(global, lowCats){
        const company=(document.getElementById('company')?.value||'').trim();
        const sector=(document.getElementById('sector')?.value||'').trim();
        const who = company ? ` pour ${company}` : '';
        const inSector = sector ? ` (${sector})` : '';
        const reco=[];
        if(global<50){
          reco.push(`Atelier de cadrage 2h${who}${inSector} : objectifs, périmètre pilotes et ROI cible.`,
                    `POC rapide sur 1 ligne (≤ 6 semaines) : mesure d’impact et plan d’industrialisation.`);
        } else {
          reco.push(`Roadmap 90 jours${who} : déploiement multi-lignes, standardisation et gouvernance.`,
                    `Kit de déploiement (Edge + monitoring) : réplication scalable site → site.`);
        }
        lowCats.forEach(c=>{
          if(c.key==='it'){reco.push(`Audit éclair IT/OT : réseau usine, sauvegardes, sécurité ; socle données.`);}
          else if(c.key==='qual'){reco.push(`Poste de vision : caméra/éclairage/annotation + suivi NOK/scrap.`);}
          else if(c.key==='ml'){reco.push(`Pipeline MLOps${inSector} : entraînement, versionning, ré-apprentissage.`);}
          else if(c.key==='prod'){reco.push(`Standardisation changeovers & exposition des signaux (API/OPC/MQTT).`);}
          else if(c.key==='gov'){reco.push(`PMO data/IA${who} : sponsoring, KPI (scrap, TRS), comités mensuels.`);}
          else if(c.key==='org'){reco.push(`Acculturation & formation ciblée (SOP, runbooks), binôme champion.`);}
        });
        return Array.from(new Set(reco));
      }

      const payload = {
        ts: new Date().toISOString(),
        meta: {
          company: document.getElementById('company')?.value?.trim() || '',
          sector:  document.getElementById('sector')?.value?.trim() || '',
          email:   document.getElementById('email')?.value?.trim() || ''
        },
        answers,
        computed: { global, level, catScores, reco: buildRecoPredicta(global, low) }
      };
      sessionStorage.setItem('diagnostic_results', JSON.stringify(payload));

      // >>> remplace l’ancienne redirection par la transition <<<
      goWithCurtain('results.html');
    }

    // (listeners inchangés)
    document.getElementById('compute').addEventListener('click', computeAndGo);
    document.getElementById('reset').addEventListener('click', resetAll);
    document.getElementById('quickDone').addEventListener('click', quickFill);
    document.getElementById('quickDone_footer').addEventListener('click', quickFill);
    document.getElementById('print').addEventListener('click', ()=>window.print());
  </script>
</body>
</html>

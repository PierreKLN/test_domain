<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RÃ©sultats â€” Diagnostic Industrie</title>
  <style>
    /* ... (tes styles existants) ... */

    /* ====== Apparition Ã  lâ€™arrivÃ©e ====== */
    body.is-hidden *{ visibility:hidden; } /* Ã©vite le flash */
    body.ready .reveal{
      animation: result-reveal 520ms cubic-bezier(.2,.7,.2,1) both;
    }
    @keyframes result-reveal{
      from{ opacity:0; filter:blur(8px); transform: translateY(12px) scale(.992); }
      60%{ opacity:1; filter:blur(0); transform: translateY(0) scale(1); }
      to  { opacity:1; }
    }

    /* petit â€œcontre-rideauâ€ */
    #arrival-wipe{
      position:fixed; inset:0; pointer-events:none; opacity:1;
      background:
        radial-gradient(1200px 600px at 85% 110%, rgba(255,255,255,.08), transparent 60%) ,
        linear-gradient(315deg, rgba(10,132,255,.65), rgba(0,0,0,.0) 55%) ,
        linear-gradient(180deg, rgba(0,0,0,.95), rgba(0,0,0,.88));
      transform: translateX(-100%);
      z-index:9999;
    }
    .arrival-animate{
      animation: arrival-wipe 520ms cubic-bezier(.2,.7,.2,1) forwards;
    }
    @keyframes arrival-wipe{
      0%   { transform: translateX(-100%); }
      40%  { transform: translateX(0%); }
      100% { transform: translateX(-110%); opacity:0; }
    }

    @media (prefers-reduced-motion: reduce){
      body.ready .reveal{ animation:none !important; }
      #arrival-wipe{ display:none !important; }
    }
  </style>
</head>
<body class="is-hidden">
  <!-- contre-rideau pour lâ€™arrivÃ©e -->
  <div id="arrival-wipe" aria-hidden="true"></div>

  <div class="topbar reveal">
    <div class="brand"><div class="logo" aria-hidden="true"></div> RÃ©sultats du diagnostic</div>
  </div>

  <section class="section reveal">
    <div class="container">
      <div class="card reveal">
        <div class="hdr">
          <div class="score-badge">
            <span>Score global</span> <strong id="score">â€”</strong>
          </div>
          <div>ğŸ“Š <span id="level" class="lvl">N/A</span></div>
        </div>

        <div class="kv">
          <span class="pill">ğŸ¢ <strong id="companyLabel">â€”</strong></span>
          <span class="pill">ğŸ­ <span id="sectorLabel">â€”</span></span>
          <span class="pill">âœ‰ï¸ <span id="emailLabel">â€”</span></span>
          <span class="pill">ğŸ•’ <span id="dateLabel">â€”</span></span>
        </div>

        <div class="bars" id="catbars"></div>

        <div style="margin-top:16px">
          <h3 style="margin:0 0 8px">Recommandations prioritaires</h3>
          <ol id="reco" class="list"></ol>
          <small class="muted">Ces actions sont gÃ©nÃ©rÃ©es en fonction de vos rÃ©ponses.</small>
        </div>

        <div class="section" style="padding:16px 0 0">
          <div class="actions">
            <a class="cta" href="index.html">â† Refaire le diagnostic</a>
            <button class="ghost" id="export">Exporter le rÃ©sultat (JSON)</button>
            <button class="ghost" id="print">Imprimer / PDF</button>
            <button class="ghost" id="clear">Effacer les donnÃ©es</button>
          </div>
        </div>

      </div>
    </div>
  </section>

  <script>
    function load(){
      const raw=sessionStorage.getItem('diagnostic_results');
      if(!raw){
        document.getElementById('score').textContent='â€”';
        document.getElementById('level').textContent='N/A';
        document.getElementById('catbars').innerHTML='<div class="muted">Aucune donnÃ©e trouvÃ©e. <a href="index.html">Lancer le diagnostic</a>.</div>';
        return null;
      }
      try{ return JSON.parse(raw); }catch(_){ return null; }
    }
    function render(data){
      if(!data) return;
      const {meta, computed, ts} = data;
      document.getElementById('score').textContent = (computed.global||0) + '%';
      document.getElementById('level').textContent = computed.level || 'N/A';
      document.getElementById('companyLabel').textContent = meta.company || 'â€”';
      document.getElementById('sectorLabel').textContent  = meta.sector || 'â€”';
      document.getElementById('emailLabel').textContent   = meta.email || 'â€”';
      document.getElementById('dateLabel').textContent    = new Date(ts).toLocaleString();

      const wrap=document.getElementById('catbars'); wrap.innerHTML='';
      (computed.catScores||[]).forEach(c=>{
        const row=document.createElement('div'); row.className='barrow reveal';
        row.style.animationDelay = (80 * (wrap.children.length+1)) + 'ms';
        row.innerHTML=`<div>${c.label}</div><div class='barx'><div class='fill' style='width:${c.pct}%'></div></div>`;
        wrap.appendChild(row);
      });

      const list=document.getElementById('reco'); list.innerHTML='';
      (computed.reco||[]).forEach((r,i)=>{ const li=document.createElement('li'); li.className='reveal'; li.style.animationDelay=(120*i)+'ms'; li.textContent=r; list.appendChild(li); });
    }

    function exportJSON(){
      const raw=sessionStorage.getItem('diagnostic_results');
      if(!raw){ alert('Aucune donnÃ©e Ã  exporter.'); return; }
      const blob=new Blob([JSON.stringify(JSON.parse(raw),null,2)],{type:'application/json'});
      const url=URL.createObjectURL(blob); const a=document.createElement('a');
      a.href=url; a.download='diagnostic_maturite.json'; a.click(); URL.revokeObjectURL(url);
    }
    function clearData(){
      sessionStorage.removeItem('diagnostic_results');
      location.reload();
    }

    document.getElementById('export').addEventListener('click', exportJSON);
    document.getElementById('print').addEventListener('click', ()=>window.print());
    document.getElementById('clear').addEventListener('click', clearData);

    // DÃ©marrage : on charge, on rend, puis on joue lâ€™anim dâ€™arrivÃ©e
    window.addEventListener('DOMContentLoaded', ()=>{
      render(load());
      // montre la page et lance le "contre-rideau"
      document.body.classList.remove('is-hidden');
      document.body.classList.add('ready');
      const wipe = document.getElementById('arrival-wipe');
      // Lancer une fois que le DOM est prÃªt pour Ã©viter un flash
      requestAnimationFrame(()=>{ wipe.classList.add('arrival-animate'); });
    });
  </script>
</body>
</html>

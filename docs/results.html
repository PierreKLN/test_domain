<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>R√©sultats ‚Äî Diagnostic Industrie</title>
  <style>
    :root{
      --bg-dark:#000; --fg-dark:#f5f5f7; --muted-dark:#a1a1a6; --line-dark:#1c1c1e;
      --card-dark:rgba(255,255,255,0.06); --pill-dark:rgba(255,255,255,0.08); --glass-border-dark:rgba(255,255,255,0.12);
      --accent:#0a84ff; --danger:#ff3b30;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","SF Pro Display",Segoe UI,Roboto,Helvetica,Arial,sans-serif; background:var(--bg-dark); color:var(--fg-dark);}
    .topbar{position:sticky; top:0; z-index:50; display:flex; align-items:center; justify-content:center; height:52px; border-bottom:1px solid var(--line-dark); backdrop-filter:saturate(180%) blur(14px); background:rgba(0,0,0,.6); color:var(--fg-dark);}
    .brand{display:flex;align-items:center;gap:10px;font-weight:600}
    .logo{width:18px;height:18px;border-radius:6px; background: radial-gradient(circle at 30% 30%, #fff 0%, #bbb 20%, #222 55%), #111; box-shadow: 0 2px 8px rgba(0,0,0,.6) inset, 0 0 0 1px var(--glass-border-dark);}

    .section{padding:32px 0}
    .container{max-width:1080px;margin:0 auto;padding:0 24px}
    .card{border-radius:20px; padding:20px; box-shadow:0 10px 40px rgba(0,0,0,.12); backdrop-filter: blur(10px) saturate(120%); border:1px solid var(--glass-border-dark); background:var(--card-dark)}
    .muted{color:var(--muted-dark)}

    .score-badge{display:inline-flex; gap:10px; align-items:center; padding:10px 14px; border-radius:14px; background:rgba(255,255,255,0.04); border:1px solid var(--glass-border-dark)}
    .score-badge strong{font-size:24px; letter-spacing:-.02em}
    .lvl{font-weight:700; color:#2b9d42}

    .bars{display:grid;gap:10px;margin-top:14px}
    .barrow{display:grid;grid-template-columns:200px 1fr; align-items:center;gap:10px}
    .barx{height:10px;border-radius:999px;overflow:hidden; background:#0b0b0c; border:1px solid var(--line-dark)}
    .fill{height:100%;background:linear-gradient(90deg,#0bd3d3,#0a84ff);width:0%}

    .actions{display:flex;gap:10px;flex-wrap:wrap}
    .cta,.ghost{cursor:pointer; border:none; border-radius:999px; padding:12px 18px; font-weight:600}
    .cta{background:linear-gradient(180deg,#0a84ff,#0066cc); color:white; border:1px solid #0a84ff}
    .ghost{background:transparent; color:#e5e5ea; border:1px solid var(--glass-border-dark); background:var(--pill-dark)}

    .list{margin:0 0 8px 18px;line-height:1.6}
    .hdr{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .pill{display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; font-size:14px; background:var(--pill-dark); border:1px solid var(--glass-border-dark); color:#d8d8dc}
    .kv{display:flex; gap:12px; flex-wrap:wrap; margin-top:8px}
    .kv .pill strong{font-weight:600}
    a{color:var(--accent); text-decoration:none}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="brand"><div class="logo" aria-hidden="true"></div> R√©sultats du diagnostic</div>
  </div>

  <section class="section">
    <div class="container">
      <div class="card">
        <div class="hdr">
          <div class="score-badge">
            <span>Score global</span> <strong id="score">‚Äî</strong>
          </div>
          <div>üìä <span id="level" class="lvl">N/A</span></div>
        </div>

        <div class="kv">
          <span class="pill">üè¢ <strong id="companyLabel">‚Äî</strong></span>
          <span class="pill">üè≠ <span id="sectorLabel">‚Äî</span></span>
          <span class="pill">‚úâÔ∏è <span id="emailLabel">‚Äî</span></span>
          <span class="pill">üïí <span id="dateLabel">‚Äî</span></span>
        </div>

        <div class="bars" id="catbars"></div>

        <div style="margin-top:16px">
          <h3 style="margin:0 0 8px">Recommandations prioritaires</h3>
          <ol id="reco" class="list"></ol>
          <small class="muted">Ces actions sont g√©n√©r√©es en fonction de vos r√©ponses.</small>
        </div>

        <div class="section" style="padding:16px 0 0">
          <div class="actions">
            <a class="cta" href="index.html">‚Üê Refaire le diagnostic</a>
            <button class="ghost" id="export">Exporter le r√©sultat (JSON)</button>
            <button class="ghost" id="print">Imprimer / PDF</button>
            <button class="ghost" id="clear">Effacer les donn√©es</button>
          </div>
        </div>

      </div>
    </div>
  </section>

  <script>
    function load(){
      const raw=sessionStorage.getItem('diagnostic_results');
      if(!raw){
        // Fallback si la page est ouverte sans calcul pr√©alable
        document.getElementById('score').textContent='‚Äî';
        document.getElementById('level').textContent='N/A';
        document.getElementById('catbars').innerHTML='<div class="muted">Aucune donn√©e trouv√©e. <a href="index.html">Lancer le diagnostic</a>.</div>';
        return null;
      }
      try{
        return JSON.parse(raw);
      }catch(_){
        return null;
      }
    }
    function render(data){
      if(!data) return;
      const {meta, computed, ts} = data;
      document.getElementById('score').textContent = (computed.global||0) + '%';
      document.getElementById('level').textContent = computed.level || 'N/A';
      document.getElementById('companyLabel').textContent = meta.company || '‚Äî';
      document.getElementById('sectorLabel').textContent  = meta.sector || '‚Äî';
      document.getElementById('emailLabel').textContent   = meta.email || '‚Äî';
      document.getElementById('dateLabel').textContent    = new Date(ts).toLocaleString();

      const wrap=document.getElementById('catbars'); wrap.innerHTML='';
      (computed.catScores||[]).forEach(c=>{
        const row=document.createElement('div'); row.className='barrow';
        row.innerHTML=`<div>${c.label}</div><div class='barx'><div class='fill' style='width:${c.pct}%'></div></div>`;
        wrap.appendChild(row);
      });

      const list=document.getElementById('reco'); list.innerHTML='';
      (computed.reco||[]).forEach(r=>{ const li=document.createElement('li'); li.textContent=r; list.appendChild(li); });
    }

    function exportJSON(){
      const raw=sessionStorage.getItem('diagnostic_results');
      if(!raw){ alert('Aucune donn√©e √† exporter.'); return; }
      const blob=new Blob([JSON.stringify(JSON.parse(raw),null,2)],{type:'application/json'});
      const url=URL.createObjectURL(blob); const a=document.createElement('a');
      a.href=url; a.download='diagnostic_maturite.json'; a.click(); URL.revokeObjectURL(url);
    }

    function clearData(){
      sessionStorage.removeItem('diagnostic_results');
      location.reload();
    }

    document.getElementById('export').addEventListener('click', exportJSON);
    document.getElementById('print').addEventListener('click', ()=>window.print());
    document.getElementById('clear').addEventListener('click', clearData);

    // Init
    render(load());
  </script>
</body>
</html>
